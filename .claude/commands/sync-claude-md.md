<!-- @description Re-analyzes your project and updates CLAUDE.md to reflect current state. -->

# Sync CLAUDE.md

Re-analyze the project and update CLAUDE.md to reflect current state.

Run this when your project has changed significantly:
- Added a major framework or dependency
- Changed npm scripts or build commands
- Restructured the project
- Switched databases or services

## Step 1: Re-analyze the Project

Scan for current project indicators:

**Package/Config Files:**
- `package.json` → dependencies, scripts
- `requirements.txt` / `pyproject.toml` → Python deps
- `Cargo.toml`, `go.mod`, `Gemfile`, etc.

**Framework Indicators:**
- Config files (next.config.*, vite.config.*, etc.)
- Directory structure (app/, src/, etc.)

**Infrastructure:**
- Docker, Terraform, CI/CD configs

## Step 2: Update CLAUDE.md

CLAUDE.md uses markers to identify auto-generated content. Include an ISO timestamp for the guard hook:

```markdown
<!-- AUTO-GENERATED BY /autoconfig at {ISO_TIMESTAMP}Z — Do not edit. Use .claude/feedback/ for corrections. -->
...content...
<!-- END AUTO-GENERATED -->
```

Replace `{ISO_TIMESTAMP}` with the current UTC time (e.g., `2026-01-14T16:30:45Z`).

**Only regenerate content between these markers.** If content exists outside the markers (user added it despite the warning), preserve it.

**After writing CLAUDE.md**, immediately save a snapshot copy to `.claude/.claude-md-snapshot`. This is used by the guard hook to restore CLAUDE.md if a user edits it directly.

Compare detected state with current CLAUDE.md and update:

1. **Project name** — if changed
2. **Tech stack** — new frameworks, languages, databases
3. **Commands** — new/changed npm scripts, build commands
4. **Conventions** — if project structure changed

**Always include within markers:**
- The `## Retro` section pointer
- The `## Team Feedback` section pointer

## Step 3: Confirm Changes

Show the user what changed in CLAUDE.md before finishing.

## Guidelines

- **Respect markers**: Only regenerate content between AUTO-GENERATED markers
- **Be conservative**: Only update sections that actually changed
- **Keep it tight**: CLAUDE.md should stay concise
