<!-- @description The command you just ran. Analyzes your project and populates CLAUDE.md with real context. Re-run anytime your stack changes. -->

# Autoconfig

Analyze this project and configure Claude Code with real context.

**Setup Note**: During autoconfig, prefer Glob/Read/Write tools over Bash commands. This ensures smooth setup without permission prompts. Only use Bash for opening the guide at the end.

## Step 1: Detect Environment

**Operating System:**
Check the platform and note it for command syntax:
- Windows → use `del`, `rmdir`, backslashes, `.cmd`/`.ps1` scripts
- macOS/Linux → use `rm`, `mkdir -p`, forward slashes, `.sh` scripts

Include this in CLAUDE.md so all commands use the correct syntax.

## Step 2: Scan the Project

Look for these indicators to understand the project:

**Package/Config Files:**
- `package.json` → Node.js, npm scripts, dependencies
- `requirements.txt` / `pyproject.toml` / `setup.py` → Python
- `Cargo.toml` → Rust
- `go.mod` → Go
- `Gemfile` → Ruby
- `pom.xml` / `build.gradle` → Java
- `*.csproj` / `*.sln` → .NET
- `composer.json` → PHP

**Framework Indicators:**
- `next.config.*` / `app/` directory → Next.js
- `vite.config.*` → Vite
- `angular.json` → Angular
- `svelte.config.*` → Svelte
- `remix.config.*` → Remix
- `nuxt.config.*` → Nuxt
- `django` in imports → Django
- `flask` in imports → Flask
- `fastapi` in imports → FastAPI
- `express` in dependencies → Express
- `rails` / `Gemfile` with rails → Rails
- `laravel` → Laravel

**Testing Frameworks:**
- `jest.config.*` / `@jest` in deps → Jest
- `vitest.config.*` → Vitest
- `pytest.ini` / `conftest.py` → Pytest
- `*_test.go` files → Go testing
- `*_spec.rb` files → RSpec
- `cypress/` or `playwright/` → E2E testing

**Infrastructure:**
- `Dockerfile` / `docker-compose.*` → Docker
- `*.tf` files → Terraform
- `k8s/` or `kubernetes/` → Kubernetes
- `.github/workflows/` → GitHub Actions
- `serverless.yml` → Serverless Framework

## Step 3: Populate CLAUDE.md

Focus on what Claude Code actually needs to work effectively. Claude can explore the codebase itself — don't document what it can discover.

**Wrap content in markers** so `/sync-claude-md` knows what's auto-generated:

```markdown
<!-- AUTO-GENERATED BY /autoconfig — Do not edit. Use .claude/feedback/ for corrections. -->

# Project Name
...content...

<!-- END AUTO-GENERATED -->
```

**Always include:**
- **Project name + one-liner**: What is this thing?
- **Tech stack**: Runtime, framework, database, key services (so Claude uses correct patterns)
- **Commands**: How to run, test, build, deploy — Claude needs these to execute tasks
- **Non-obvious conventions**: Multi-schema databases, monorepo structure, unusual patterns Claude wouldn't infer

**Include if relevant:**
- **Deployment flow**: If non-standard or involves multiple steps
- **Key architectural decisions**: Only if Claude would make wrong assumptions without them

**Skip these — Claude can discover them:**
- Detailed project structure trees (Claude can run `ls` or `tree`)
- Exhaustive route/endpoint lists (Claude can grep)
- File-by-file descriptions (Claude can read files)
- Database model lists (Claude can read schema files)

**Keep it tight.** A 30-line CLAUDE.md that hits the essentials beats a 200-line doc Claude has to parse every session.

**Always end with:**
```markdown
## Team Feedback
See `.claude/feedback/` for corrections and guidance from the team.
```

This pointer persists across autoconfig runs and directs Claude to team-maintained content.

## Step 4: Create Rules Directory

Create `.claude/rules/` directory if it doesn't exist by writing a `.gitkeep` file to it:

```
Write .claude/rules/.gitkeep with empty content
```

**Important**: Use Write tool to create the directory (by creating a placeholder file), not `mkdir` Bash commands. This avoids permission prompts during setup.

Rules are path-scoped context files that load automatically when Claude works on matching files. Effective rules require deep understanding of your codebase patterns, team conventions, and quality goals — they should be crafted intentionally, not auto-generated.

## Step 5: Configure Settings

Update `.claude/settings.json` using the official schema.

### Deny Patterns (files Claude shouldn't read/write)

Use `Read()` for blocking reads, `Edit()` for blocking writes:

**Always deny (security):**
```
Read(./.env)
Read(./.env.*)
Read(./secrets/**)
Edit(./.env)
Edit(./.env.*)
```

**Always deny (Windows artifacts):**
```
Write(./nul)
Edit(./nul)
```
These prevent accidental `nul` file creation from bash/Windows command translation issues.

**Often deny (generated/vendor):**
```
Edit(./node_modules/**)
Edit(./dist/**)
Edit(./.git/**)
```

### Allow Patterns (auto-approve without prompting)

Use `Bash()` patterns with prefix matching:

```
Bash(npm run test:*)
Bash(npm run lint:*)
Bash(npm run build)
```

### Environment Variables

Set session-level env vars:

```json
{
  "env": {
    "NODE_ENV": "development"
  }
}
```

**Keep it minimal** — only include patterns that actually exist in this project.

## Guidelines

- Replace ALL placeholder content with real values from THIS project
- Delete sections that don't apply — no empty stubs
- Optimize for Claude's efficiency, not human documentation
- When uncertain, leave it out — Claude can ask or explore

## Step 6: Update the Docs

After populating CLAUDE.md, update the docs file preview to show the actual content:

1. Open `.claude/docs/autoconfig.docs.html`
2. Find the `fileContents` JavaScript object (search for `'claude-md':`)
3. Replace the `content` value with the actual CLAUDE.md content you just generated
4. Use template literal syntax and escape any backticks in the content

This ensures double-clicking CLAUDE.md in the docs shows the real generated content.

## After Completion

### Open Docs & Finale

Open the interactive docs in the user's browser:

- macOS: `open .claude/docs/autoconfig.docs.html`
- Linux: `xdg-open .claude/docs/autoconfig.docs.html`
- Windows: `start .claude/docs/autoconfig.docs.html`

Then output this finale message (just output it directly as text, no bash command needed):

---

✅ Setup complete! The interactive docs are now open in your browser.

**IMPORTANT**: Do not add any additional text, summaries, or details after this message. The finale should be clean and punchy - end here.